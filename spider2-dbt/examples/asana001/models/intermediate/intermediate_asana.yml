version: 2

models:
  - name: int_asana__project_task_metrics
    description: Draws from (non-intermediate) ASANA_TASK to compute metrics about tasks in each project.
    columns:
      - name: project_id
        tests:
          - unique
          - not_null

  - name: int_asana__project_user
    description: Table of who is *working* on the project -- its owner + users assigned to it tasks 
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - project_id
            - user_id
            - role
            - currently_working_on

  - name: int_asana__subtask_parent
    description: Combines subtasks + information regarding parent tasks
    columns:
      - name: subtask_id
        tests: 
          - unique
          - not_null
    
  - name: int_asana__task_assignee
    description: Combines tasks + information regarding their assigned user
    columns:
      - name: task_id
        tests:
          - unique
          - not_null
  
  - name: int_asana__task_comments
    description: Aggregates all comments on a task into a conversation + the number of comments
    columns: 
      - name: task_id
        tests:
          - unique
          - not_null

  - name: int_asana__task_first_modifier
    description: Extracts the first person to make a story (modify) the task. A proxy for the task creator, since that's not provided.
    columns:
      - name: task_id
        tests:
          - unique
          - not_null

  - name: int_asana__task_followers
    description: Aggregates a count of and a list of the names of the users who follow each task
    columns:
      - name: task_id
        tests:
          - unique
          - not_null

  - name: int_asana__task_open_length
    description: Computes the days that each task has spent open and assigned.
    columns:
      - name: task_id
        tests:
          - unique
          - not_null

  - name: int_asana__task_projects
    description: Aggregates a count of and a list of the names of the projects and sections that each task belongs to.
    columns:
      - name: task_id
        tests:
          - unique
          - not_null
  
  - name: int_asana__task_story
    description: Parses and categorizes asana stories into action types. Useful for looking at individual-task histories
    columns:
      - name: story_id
        tests:
          - unique
          - not_null
      - name: action_taken
        description: The bucket that the story event falls into.
      - name: comment_content
        description: If the action taken is a comment, this is the comment's text. Otherwise null.
      - name: action_description
        description: The original pre-categorized content of the story

  - name: int_asana__task_tags
    description: Aggregates a count of and a list of the names of the tags attached to each task.
    columns:
      - name: task_id
        tests:
          - unique
          - not_null

  - name: int_asana__user_task_metrics
    description: Draws from (non-intermediate) ASANA_TASK to compute metrics about tasks for each user.
    columns:
      - name: user_id
        tests:
          - unique
          - not_null
