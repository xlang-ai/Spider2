WITH ordered AS ( SELECT visit_id, sequence_number, event_type FROM shopping_cart_events ), seqs AS ( SELECT o1.visit_id, o1.event_type AS e1, o2.event_type AS e2, o3.event_type AS e3 FROM ordered o1 JOIN ordered o2 ON o2.visit_id = o1.visit_id AND o2.sequence_number = o1.sequence_number + 1 JOIN ordered o3 ON o3.visit_id = o1.visit_id AND o3.sequence_number = o2.sequence_number + 1 ) SELECT ie1.event_name || ' -> ' || ie2.event_name || ' -> ' || ie3.event_name AS sequence, COUNT(*) AS frequency FROM seqs s JOIN shopping_cart_event_identifier ie1 ON s.e1 = ie1.event_type JOIN shopping_cart_event_identifier ie2 ON s.e2 = ie2.event_type JOIN shopping_cart_event_identifier ie3 ON s.e3 = ie3.event_type GROUP BY sequence ORDER BY frequency DESC LIMIT 1;