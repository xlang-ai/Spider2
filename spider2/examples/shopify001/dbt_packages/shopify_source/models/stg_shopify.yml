version: 2

models:
  - name: stg_shopify__customer
    description: Each record represents a customer in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - customer_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: marketing_consent_state
        description: >
          Field indicating if the customer has consented to receive marketing material via email. Coalescing of the new `email_marketing_consent_state`
          field and the deprecated `accepts_marketing` field. Records with the old field will be marked with '(legacy)'.
      - name: marketing_opt_in_level
        description: The marketing subscription opt-in level, as described in the M3AAWG Sender Best Common Practices, that the customer gave when they consented to receive marketing material by email.
      - name: marketing_consent_updated_at
        description: The date and time when the customer consented to receive marketing material by email. If no date is provided, then the date and time when the consent information was sent is used.
      - name: created_timestamp
        description: The date and time when the customer was created.
      - name: default_address_id
        description: The default address for the customer.
      - name: email
        description: The unique email address of the customer. Attempting to assign the same email address to multiple customers returns an error.
      - name: first_name
        description: The customer's first name.
      - name: customer_id
        description: A unique identifier for the customer.
      - name: last_name
        description: The customer's last name.
      - name: orders_count
        description: The number of orders associated with this customer.
      - name: phone
        description: The unique phone number (E.164 format) for this customer. Attempting to assign the same phone number to multiple customers returns an error.
      - name: account_state
        description: The state of the customer's account with a shop.
      - name: is_tax_exempt
        description: Whether the customer is exempt from paying taxes on their order. If true, then taxes won't be applied to an order at checkout. If false, then taxes will be applied at checkout.
      - name: total_spent
        description: The total amount of money that the customer has spent across their order history.
      - name: updated_timestamp
        description: The date and time when the customer information was last updated.
      - name: is_verified_email
        description: Whether the customer has verified their email address.
      - name: currency 
        description: The three-letter code (ISO 4217 format) for the currency that the customer used when they paid for their last order. Defaults to the shop currency. Returns the shop currency for test orders.
      - name: source_relation
        description: "{{ doc('source_relation') }}"
      - name: note
        description: A note about the customer.

  - name: stg_shopify__order_line_refund
    description: Each record represents a line item from an order in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_line_refund_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: order_line_refund_id
        description: The unique identifier of the line item in the refund.
      - name: location_id
        description: TThe unique identifier of the location where the items will be restockedBD
      - name: order_line_id
        description: The ID of the related line item in the order.
      - name: quantity
        description: The quantity of the associated line item that was returned.
      - name: refund_id
        description: The ID of the related refund.
      - name: restock_type
        description: How this refund line item affects inventory levels.
      - name: subtotal
        description: Subtotal amount of the order line refund in shop currency.
      - name: total_tax
        description: The total tax applied to the refund in the shop currency.
      - name: source_relation
        description: "{{ doc('source_relation') }}"
      - name: subtotal_set 
        description: The subtotal of the refund line item in shop and presentment currencies.
      - name: total_tax_set 
        description: The total tax of the line item in shop and presentment currencies.

  - name: stg_shopify__order_line
    description: Each record represents a line item from an order in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_line_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: fulfillable_quantity
        description: "The amount available to fulfill, calculated as follows: quantity - max(refunded_quantity, fulfilled_quantity) - pending_fulfilled_quantity - open_fulfilled_quantity"
      - name: fulfillment_status
        description: How far along an order is in terms line items fulfilled.
      - name: is_gift_card
        description: Whether the item is a gift card. If true, then the item is not taxed or considered for shipping charges.
      - name: grams
        description: The weight of the item in grams.
      - name: order_line_id
        description: The ID of the line item.
      - name: name
        description: The name of the product variant.
      - name: order_id
        description: The ID of the related order.
      - name: price
        description: The price of the item before discounts have been applied in the shop currency.
      - name: product_id
        description: The ID of the product that the line item belongs to. Can be null if the original product associated with the order is deleted at a later date.
      - name: quantity
        description: The number of items that were purchased.
      - name: is_shipping_required
        description: Whether the item requires shipping.
      - name: sku
        description: The item's SKU (stock keeping unit).
      - name: is_taxable
        description: Whether the item was taxable.
      - name: title
        description: The title of the product.
      - name: total_discount
        description: The total amount of the discount allocated to the line item in the shop currency.
      - name: variant_id
        description: The ID of the product variant.
      - name: vendor
        description: The name of the item's supplier.
      - name: source_relation
        description: "{{ doc('source_relation') }}"
      - name: index
        description: Index of the order line.
      - name: pre_tax_price
        description: The pre tax price of the line item in shop currency.
      - name: pre_tax_price_set
        description: The pre tax price of the line item in shop currency and presentment currency.
      - name: price_set
        description: The price of the line item in shop and presentment currencies.
      - name: tax_code
        description: Tax code applied to the line item. As multiple taxes can apply to a line item, we recommend referring to `stg_shopify__tax_line`.
      - name: total_discount_set
        description: The total amount allocated to the line item in the presentment currency.
      - name: variant_title
        description: The title of the product variant.
      - name: variant_inventory_management
        description: The fulfillment service that tracks the number of items in stock for the product variant.
      - name: properties
        description: Line item properties.

  - name: stg_shopify__order
    description: Each record represents an order in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: app_id
        description: The ID of the app that created the order.
      - name: checkout_id
        description: ID of the order's checkout. 
      - name: order_status_url
        description: The URL pointing to the order status web page, if applicable.
      - name: billing_address_address_1
        description: The street address of the billing address.
      - name: billing_address_address_2
        description: An optional additional field for the street address of the billing address.
      - name: billing_address_city
        description: The city, town, or village of the billing address.
      - name: billing_address_company
        description: The company of the person associated with the billing address.
      - name: billing_address_country
        description: The name of the country of the billing address.
      - name: billing_address_country_code
        description: The two-letter code (ISO 3166-1 format) for the country of the billing address.
      - name: billing_address_first_name
        description: The first name of the person associated with the payment method.
      - name: billing_address_last_name
        description: The last name of the person associated with the payment method.
      - name: billing_address_latitude
        description: The latitude of the billing address.
      - name: billing_address_longitude
        description: The longitude of the billing address.
      - name: billing_address_name
        description: The full name of the person associated with the payment method.
      - name: billing_address_phone
        description: The phone number at the billing address.
      - name: billing_address_province
        description: The name of the region (province, state, prefecture, …) of the billing address.
      - name: billing_address_province_code
        description: The two-letter abbreviation of the region of the billing address.
      - name: billing_address_zip
        description: The postal code (zip, postcode, Eircode, …) of the billing address.
      - name: browser_ip
        description: The IP address of the browser used by the customer when they placed the order.
      - name: has_buyer_accepted_marketing
        description: Whether the customer consented to receive email updates from the shop.
      - name: cancel_reason
        description: The reason why the order was canceled.
      - name: cancelled_timestamp
        description: The date and time when the order was canceled.
      - name: cart_token
        description: The ID of the cart that's associated with the order.
      - name: closed_timestamp
        description: The date and time when the order was closed (archived).
      - name: created_timestamp
        description: The autogenerated date and time when the order was created in Shopify.
      - name: currency
        description: The three-letter code for the shop currency.
      - name: customer_id
        description: The ID of the order's customer.
      - name: email
        description: The customer's email address.
      - name: financial_status
        description: The status of payments associated with the order. Can only be set when the order is created
      - name: fulfillment_status
        description: The order's status in terms of fulfilled line items.
      - name: order_id
        description: The ID of the order, used for API purposes. This is different from the order_number property, which is the ID used by the shop owner and customer.
      - name: landing_site_base_url
        description: The URL for the page where the buyer landed when they entered the shop.
      - name: location_id
        description: The ID of the physical location where the order was processed.
      - name: name
        description: The order name, generated by combining the order_number property with the order prefix and suffix that are set in the merchant's general settings.
      - name: note
        description: An optional note that a shop owner can attach to the order.
      - name: number
        description: The order's position in the shop's count of orders. Numbers are sequential and start at 1.
      - name: order_number
        description: The order 's position in the shop's count of orders starting at 1001. Order numbers are sequential and start at 1001.
      - name: processed_timestamp
        description: The date and time when an order was processed. This value is the date that appears on your orders and that's used in the analytic reports.
      - name: referring_site
        description: The website where the customer clicked a link to the shop.
      - name: shipping_address_address_1
        description: The street address of the shipping address.
      - name: shipping_address_address_2
        description: An optional additional field for the street address of the shipping address.
      - name: shipping_address_city
        description: The city, town, or village of the shipping address.
      - name: shipping_address_company
        description: The company of the person associated with the shipping address.
      - name: shipping_address_country
        description: The name of the country of the shipping address.
      - name: shipping_address_country_code
        description: The two-letter code (ISO 3166-1 format) for the country of the shipping address.
      - name: shipping_address_first_name
        description: The first name of the person associated with the shipping address.
      - name: shipping_address_last_name
        description: The last name of the person associated with the shipping address.
      - name: shipping_address_latitude
        description: The latitude of the shipping address.
      - name: shipping_address_longitude
        description: The longitude of the shipping address.
      - name: shipping_address_name
        description: The full name of the person associated with the payment method.
      - name: shipping_address_phone
        description: The phone number at the shipping address.
      - name: shipping_address_province
        description: The name of the region (province, state, prefecture, …) of the shipping address.
      - name: shipping_address_province_code
        description: The two-letter abbreviation of the region of the shipping address.
      - name: shipping_address_zip
        description: The postal code (zip, postcode, Eircode, …) of the shipping address.
      - name: source_name
        description: Where the order originated. Can be set only during order creation, and is not writeable afterwards.
      - name: subtotal_price
        description: The price of the order in the shop currency after discounts but before shipping, taxes, and tips.
      - name: has_taxes_included
        description: Whether taxes are included in the order subtotal.
      - name: is_test_order
        description: Whether this is a test order.
      - name: token
        description: A unique token for the order.
      - name: total_discounts
        description: The total discounts applied to the price of the order in the shop currency.
      - name: total_line_items_price
        description: The sum of all line item prices in the shop currency.
      - name: total_price
        description: The sum of all line item prices, discounts, shipping, taxes, and tips in the shop currency. Must be positive.
      - name: total_tax
        description: The sum of all the taxes applied to the order in th shop currency. Must be positive).
      - name: total_weight
        description: The sum of all line item weights in grams.
      - name: updated_timestamp
        description: The date and time (ISO 8601 format) when the order was last modified.
      - name: user_id
        description: The ID of the user logged into Shopify POS who processed the order, if applicable.
      - name: total_shipping_price_set
        description: The total shipping price set for the order in presentment and shop currencies.
      - name: checkout_token
        description: A unique value when referencing the checkout that's associated with the order.
      - name: customer_locale 
        description: A two-letter or three-letter language code, optionally followed by a region modifier.
      - name: is_deleted
        description: "{{ doc('_fivetran_deleted') }}"
      - name: total_tip_received
        description: The sum of all the tips in the order in the shop currency.
      - name: client_details_user_agent
        description: Details of the browsing client, including software and operating versions.
      - name: total_tax_set
        description: The total tax applied to the order in shop and presentment currencies.
      - name: total_shipping_price_set
        description: The total shipping price of the order, excluding discounts and returns, in shop and presentment currencies. If taxes_included is set to true, then total_shipping_price_set includes taxes.
      - name: total_discounts_set
        description: The total discounts applied to the price of the order in shop and presentment currencies.
      - name: presentment_currency
        description: The presentment currency that was used to display prices to the customer.
      - name: source_relation
        description: "{{ doc('source_relation') }}"
      - name: total_line_items_price_set
        description: The total of all line item prices in shop and presentment currencies.
      - name: total_price_set
        description: The total price of the order in shop and presentment currencies.
      - name: is_confirmed
        description: Whether the order is confirmed.
      - name: source_relation
        description: The ID of the order placed on the originating platform. This value doesn't correspond to the Shopify ID that's generated from a completed draft.

  - name: stg_shopify__product
    description: Each record represents a product in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - product_id
            - source_relation
    columns:
      - name: is_deleted
        description: Whether the record has been deleted in the source system.
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: created_timestamp
        description: The date and time when the product was created.
      - name: handle
        description: A unique human-friendly string for the product. Automatically generated from the product's title.
      - name: product_id
        description: An unsigned 64-bit integer that's used as a unique identifier for the product. Each id is unique across the Shopify system. No two products will have the same id, even if they're from different shops.
      - name: product_type
        description: A categorization for the product used for filtering and searching products.
      - name: published_timestamp
        description: The date and time (ISO 8601 format) when the product was published. Can be set to null to unpublish the product from the Online Store channel.
      - name: published_scope
        description: Whether the product is published to the Point of Sale channel.
      - name: title
        description: The name of the product.
      - name: updated_timestamp
        description: The date and time when the product was last modified.
      - name: vendor
        description: The name of the product's vendor.
      - name: source_relation
        description: "{{ doc('source_relation') }}"
      - name: status
        description: >
          The status of the product. Valid values:
          - active: The product is ready to sell and is available to customers on the online store, sales channels, and apps. By default, existing products are set to active.
          - archived: The product is no longer being sold and isn't available to customers on sales channels and apps.
          - draft: The product isn't ready to sell and is unavailable to customers on sales channels and apps. By default, duplicated and unarchived products are set to draft.


  - name: stg_shopify__product_variant
    description: Each record represents a product variant in Shopify
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - variant_id
            - source_relation
    columns:
      - name: barcode
        description: The barcode, UPC, or ISBN number for the product.
      - name: compare_at_price
        description: The original price of the item before an adjustment or a sale in shop currency
      - name: created_timestamp
        description: The date and time (ISO 8601 format) when the product variant was created.
      - name: fulfillment_service
        description: The fulfillment service associated with the product variant.
      - name: grams
        description: The weight of the product variant in grams.
      - name: variant_id
        description: The unique numeric identifier for the product variant.
      - name: image_id
        description: The unique numeric identifier for a product's image. The image must be associated to the same product as the variant.
      - name: inventory_item_id
        description: The unique identifier for the inventory item, which is used in the Inventory API to query for inventory information.
      - name: inventory_management
        description: The fulfillment service that tracks the number of items in stock for the product variant.
      - name: inventory_policy
        description: Whether customers are allowed to place an order for the product variant when it's out of stock.
      - name: inventory_quantity
        description: An aggregate of inventory across all locations. To adjust inventory at a specific location, use the InventoryLevel resource.
      - name: option_1
        description: "The custom properties that a shop owner uses to define product variants. You can define three options for a product variant: option1, option2, option3."
      - name: option_2
        description: "The custom properties that a shop owner uses to define product variants. You can define three options for a product variant: option1, option2, option3."
      - name: option_3
        description: "The custom properties that a shop owner uses to define product variants. You can define three options for a product variant: option1, option2, option3."
      - name: position
        description: The order of the product variant in the list of product variants. The first position in the list is 1. The position of variants is indicated by the order in which they are listed.
      - name: price
        description: The price of the product variant.
      - name: product_id
        description: The unique numeric identifier for the product.
      - name: sku
        description: A unique identifier for the product variant in the shop. Required in order to connect to a FulfillmentService.
      - name: is_taxable
        description: Whether a tax is charged when the product variant is sold.
      - name: tax_code
        description: This parameter applies only to the stores that have the Avalara AvaTax app installed. Specifies the Avalara tax code for the product variant.
      - name: title
        description: The title of the product variant. The title field is a concatenation of the option1, option2, and option3 fields. You can only update title indirectly using the option fields.
      - name: updated_timestamp
        description: The date and time when the product variant was last modified. Gets returned in ISO 8601 format.
      - name: weight
        description: The weight of the product variant in the unit system specified with weight_unit.
      - name: weight_unit
        description: "The unit of measurement that applies to the product variant's weight. If you don't specify a value for weight_unit, then the shop's default unit of measurement is applied. Valid values: g, kg, oz, and lb."
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__transaction
    description: Each record represents a transaction in Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_id
            - source_relation
    columns:
      - name: transaction_id
        description: The ID for the transaction.
      - name: order_id
        description: The ID for the order that the transaction is associated with.
      - name: refund_id
        description: The ID associated with a refund in the refund table.
      - name: amount
        description: The amount of money included in the transaction.
      - name: authorization_code
        description: The authorization code associated with the transaction.
      - name: created_timestamp
        description: The date and time when the transaction was created.
      - name: processed_timestamp
        description: The date and time when a transaction was processed.
      - name: device_id
        description: The ID for the device.
      - name: gateway
        description: The name of the gateway the transaction was issued through.
      - name: source_name
        description: The origin of the transaction.
      - name: message
        description: A string generated by the payment provider with additional information about why the transaction succeeded or failed.
      - name: currency
        description: The three-letter code (ISO 4217 format) for the currency used for the payment.
      - name: location_id
        description: The ID of the physical location where the transaction was processed.
      - name: parent_id
        description: The ID of an associated transaction.
      - name: payment_avs_result_code
        description: The response code from the address verification system.
      - name: payment_credit_card_bin
        description: The issuer identification number (IIN), formerly known as bank identification number (BIN) of the customer's credit card.
      - name: payment_cvv_result_code
        description: The response code from the credit card company indicating whether the customer entered the card security code, or card verification value, correctly.
      - name: payment_credit_card_number
        description: The customer's credit card number, with most of the leading digits redacted.
      - name: payment_credit_card_company
        description: The name of the company that issued the customer's credit card.
      - name: kind
        description: The transaction's type.
      - name: receipt
        description: A transaction receipt attached to the transaction by the gateway.
      - name: currency_exchange_id
        description: The ID of the adjustment.
      - name: currency_exchange_adjustment
        description: The difference between the amounts on the associated transaction and the parent transaction.
      - name: currency_exchange_original_amount
        description: The amount of the parent transaction in the shop currency.
      - name: currency_exchange_final_amount
        description: The amount of the associated transaction in the shop currency.
      - name: currency_exchange_currency
        description: The shop currency.
      - name: error_code
        description: A standardized error code, independent of the payment provider.
      - name: status
        description: The status of the transaction.
      - name: test
        description: Whether the transaction is a test transaction.
      - name: user_id
        description: The ID for the user who was logged into the Shopify POS device when the order was processed, if applicable.
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: source_relation
        description: "{{ doc('source_relation') }}"
      - name: authorization_expires_at
        description: The date and time (ISO 8601 format) when the Shopify Payments authorization expires.

  - name: stg_shopify__refund
    description: Each record represents a refund within Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - refund_id
            - source_relation
    columns:
      - name: refund_id
        description: The unique numeric identifier for the refund.
      - name: created_at
        description: Timestamp of the date when the refund was created.
      - name: processed_at
        description: Timestamp of the date when the refund was processed.
      - name: note
        description: User generated note attached to the refund.
      - name: restock
        description: Boolean indicating if the refund is a result of a restock.
      - name: user_id
        description: Reference to the user id which generated the refund.
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: total_duties_set
        description: Record representing total duties set for the refund.
      - name: order_id
        description: Reference to the order which the refund is associated.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__order_adjustment
    description: Each record represents and adjustment to and order within Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_adjustment_id
            - source_relation
    columns:
      - name: order_adjustment_id
        description: The unique numeric identifier for the order adjustment.
      - name: order_id
        description: Reference to the order which the adjustment is associated.
      - name: refund_id
        description: Reference to the refund which the adjustment is associated.
      - name: amount
        description: Amount of the adjustment.
      - name: tax_amount
        description: Tax amount applied to the order adjustment in the shop currency.
      - name: kind
        description: The kind of order adjustment (eg. refund, restock, etc.).
      - name: reason
        description: The reason for the order adjustment.
      - name: amount_set
        description: Amount set towards the order adjustment in presentment and shop currencies.
      - name: tax_amount_set
        description: Tax amount set towards the order adjustment in the shop and presentment currencies.
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__abandoned_checkout
    description: A checkout is considered abandoned after the customer has added contact information, but before the customer has completed their purchase.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - checkout_id
            - source_relation
    columns:
      - name: is_deleted
        description: "{{ doc('_fivetran_deleted') }}"
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: abandoned_checkout_url
        description: The recovery URL that's sent to a customer so they can recover their checkout.
      - name: billing_address_address_1
        description: The street address of the billing address.
      - name: billing_address_address_2
        description: An optional additional field for the street address of the billing address.
      - name: billing_address_city
        description: The city of the billing address.
      - name: billing_address_company
        description: The company of the person associated with the billing address.
      - name: billing_address_country
        description: The name of the country of the billing address.
      - name: billing_address_country_code
        description: The two-letter code (ISO 3166-1 alpha-2 format) for the country of the billing address.
      - name: billing_address_first_name
        description: The first name of the person associated with the payment method.
      - name: billing_address_last_name
        description: The last name of the person associated with the payment method.
      - name: billing_address_latitude
        description: The latitude of the billing address.
      - name: billing_address_longitude
        description: The longitude of the billing address.
      - name: billing_address_name
        description: The full name of the person associated with the payment method.
      - name: billing_address_phone
        description: The phone number at the billing address.
      - name: billing_address_province
        description: The name of the state or province of the billing address.
      - name: billing_address_province_code
        description: The two-letter abbreviation of the state or province of the billing address.
      - name: billing_address_zip
        description: The zip or postal code of the billing address.
      - name: has_buyer_accepted_marketing
        description: Whether the customer would like to receive email updates from the shop. This is set by the 'I want to receive occasional emails about new products, promotions and other news' checkbox during checkout.
      - name: cart_token
        description: The ID for the cart that's attached to the checkout.
      - name: closed_at
        description: The date and time (ISO 8601 format) when the checkout was closed. If the checkout was not closed, then this value is null.
      - name: created_at
        description: The date and time (ISO 8601 format) when the checkout was created.
      - name: shop_currency
        description: The three-letter code (ISO 4217 format) of the shop's default currency at the time of checkout. For the currency that the customer used at checkout, see `presentment_currency`.
      - name: customer_id
        description: ID of the customer with the abandoned checkout.
      - name: customer_locale
        description: The two or three-letter language code, optionally followed by a region modifier. Example values - en, en-CA.
      - name: device_id
        description: The ID of the Shopify POS device that created the checkout.
      - name: email
        description: The customer's email address.
      - name: gateway
        description: The payment gateway used by the checkout.
      - name: checkout_id
        description: The ID for the checkout.
        tests:
          - not_null
      - name: landing_site_base_url
        description: The URL for the page where the customer entered the shop.
      - name: location_id
        description: The ID of the physical location where the checkout was processed.
      - name: name
        description: Checkout order number. 
      - name: note
        description: The text of an optional note that a shop owner can attach to the order.
      - name: phone
        description: The customer's phone number for receiving SMS notifications.
      - name: presentment_currency
        description: The three-letter code (ISO 4217 format) of the currency that the customer used at checkout. For the shop's default currency, see `currency`.
      - name: referring_site
        description: The website that referred the customer to the shop.
      - name: shipping_address_address_1
        description: The street address of the shipping address.
      - name: shipping_address_address_2
        description: An optional additional field for the street address of the shipping address.
      - name: shipping_address_city
        description: The city of the shipping address.
      - name: shipping_address_company
        description: The company of the person associated with the shipping address.
      - name: shipping_address_country
        description: The name of the country of the shipping address.
      - name: shipping_address_country_code
        description: The two-letter code (ISO 3166-1 alpha-2 format) for the country of the shipping address.
      - name: shipping_address_first_name
        description: The first name of the person associated with the shipping address.
      - name: shipping_address_last_name
        description: The last name of the person associated with the shipping address.
      - name: shipping_address_latitude
        description: The latitude of the shipping address.
      - name: shipping_address_longitude
        description: The longitude of the shipping address.
      - name: shipping_address_name
        description: The full name of the person associated with the shipping address.
      - name: shipping_address_phone
        description: The phone number at the shipping address.
      - name: shipping_address_province
        description: The name of the state or province of the shipping address.
      - name: shipping_address_province_code
        description: The two-letter abbreviation of the state or province of the shipping address.
      - name: shipping_address_zip
        description: The zip or postal code of the shipping address.
      - name: source_name
        description: Where the checkout originated. Valid values include `web`, `pos`, `iphone`, `android`.
      - name: subtotal_price
        description: The price of the checkout in _presentment_ (customer) currency before shipping and taxes.
      - name: has_taxes_included
        description: Boolean representing whether taxes are included in the price.
      - name: token
        description: A unique ID for a checkout.
      - name: total_discounts
        description: The total amount of discounts to be applied in presentment currency.
      - name: total_duties
        description: The total duties of the checkout in presentment currency.
      - name: total_line_items_price
        description: The sum of the prices of all line items in the checkout in _presentment_ (customer) currency.
      - name: total_price
        description: The sum of line item prices, all discounts, shipping costs, and taxes for the checkout in _presentment_ (customer) currency.
      - name: total_tax
        description: The sum of all the taxes applied to the checkout in _presentment_ (customer) currency.
      - name: total_weight
        description: The sum of all the weights in grams of the line items in the checkout.
      - name: updated_at
        description: The date and time (ISO 8601 format) when the checkout was last modified.
      - name: user_id
        description: The ID of the user who created the checkout.
      - name: source_relation
        description: "{{ doc('source_relation') }}"
        
  - name: stg_shopify__collection_product
    description: Table relating products to the collections they belong to. Use this instead of the deprecated `COLLECT` table.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - collection_id
            - product_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: collection_id
        description: ID referencing the `collection` the product belongs to.
        tests:
          - not_null
      - name: product_id
        description: ID referencing the `product`.
        tests:
          - not_null
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__collection
    description: >
      A collection is a grouping of products that merchants can create to make their stores easier to browse.
      Merchants can create collections by selecting products individually or by defining rules that automatically determine whether products are included (aka a "smart collection").
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - collection_id
            - source_relation    
    columns:
      - name: is_deleted
        description: "{{ doc('_fivetran_deleted') }}"
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: rule_logic
        description: Whether the `rules` are disjunctive (logical `OR`) or conjunctive (logical `AND`)
      - name: handle
        description: A unique, human-readable string for the collection automatically generated from its title. This is used in themes by the Liquid templating language to refer to the collection.
      - name: collection_id
        description: The ID for the collection.
        tests:
          - not_null
      - name: published_at
        description: The time and date (ISO 8601 format) when the collection was made visible. Returns null for a hidden collection.
      - name: published_scope
        description: >
          Whether the collection is published to the Point of Sale channel. Valid values `web` (the collection is published to the Online Store channel but not published to the Point of Sale channel)
          and `global` (the collection is published to both the Online Store channel and the Point of Sale channel).
      - name: rules
        description: >
          An array of rules that define what products go into the smart collection. Each rule (`column` -- `relation` --> `condition`) has these properties:
          - `column`: the property of a product being used to populate the smart collection. Ex: 'tag', 'type', 'vendor', 'variant_price', etc.
          - `relation`: The comparative relationship between the column choice, and the condition ('equals', 'contains', 'greater_than', etc.)
          - condition: Select products for a smart collection using a condition. Values are either strings or numbers, depending on the relation value.
          See the [Shopify docs](https://shopify.dev/api/admin-rest/2022-10/resources/smartcollection#resource-object) for more.
      - name: sort_order
        description: >
          The order of the products in the collection. Valid values incline
          - `alpha-asc`: The products are sorted alphabetically from A to Z.
          - `alpha-des`: The products are sorted alphabetically from Z to A.
          - `best-selling`: The products are sorted by number of sales.
          - `created`: The products are sorted by the date they were created, from oldest to newest.
          - `created-desc`: The products are sorted by the date they were created, from newest to oldest.
          - `manual`: The products are manually sorted by the shop owner.
          - `price-asc`: The products are sorted by price from lowest to highest.
          - `price-desc`: The products are sorted by price from highest to lowest.
      - name: title
        description: The name of the collection
      - name: updated_at
        description: The date and time (ISO 8601 format) when the collection was last modified.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__customer_tag
    description: Tags that the shop owner has attached to the customer. A customer can have up to 250 tags.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - customer_id
            - index    
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: index
        description: Index (starting from 1) representing when the tag was placed on the customer. 
        tests:
          - not_null
      - name: customer_id
        description: ID of the customer being tagged.
        tests:
          - not_null
      - name: value
        description: Value of the tag.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__discount_code
    description: >
      Table storing discount codes that enable specific discounts to be redeemed. Merchants can distribute discount codes to their customers using a variety of means, such as an email or URL, 
      and customers can apply these codes at checkout. Each discount code belongs to a price rule, which holds the logic for the discount.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - discount_code_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: code
        description: The case-insensitive discount code that customers use at checkout. Shopify recommends this map onto the associated `price_rule.title`.
      - name: created_at
        description: The date and time (ISO 8601 format) when the discount code was created.
      - name: discount_code_id
        description: The ID for the discount code.
        tests:
          - not_null
      - name: price_rule_id
        description: The ID for the price rule that this discount code belongs to.
      - name: updated_at
        description: The date and time (ISO 8601 format) when the discount code was updated.
      - name: usage_count
        description: The number of times that the discount code has been redeemed.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__fulfillment
    description: >
      A fulfillment order represents a group of one or more items in an order that will be fulfilled from the same location. 
      A fulfillment represents work that is completed as part of a fulfillment order and can include one or more items.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - fulfillment_id
            - source_relation   
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: created_at
        description: The date and time when the fulfillment was created. The API returns this value in ISO 8601 format.
      - name: fulfillment_id
        description: The ID for the fulfillment.
        tests:
          - not_null
      - name: location_id
        description: The unique identifier of the location that the fulfillment was processed at.
      - name: name
        description: >
          The uniquely identifying fulfillment name, consisting of two parts separated by a .. The first part represents the order name and the second part represents the fulfillment number. 
          The fulfillment number automatically increments depending on how many fulfillments are in an order (e.g. #1001.1, #1001.2).
      - name: order_id
        description: The unique numeric identifier for the order.
      - name: service
        description: The fulfillment service associated with the fulfillment.
      - name: shipment_status
        description: >
          The current shipment status of the fulfillment. Valid values include:
          - label_printed: A label for the shipment was purchased and printed.
          - label_purchased: A label for the shipment was purchased, but not printed.
          - attempted_delivery: Delivery of the shipment was attempted, but unable to be completed.
          - ready_for_pickup: The shipment is ready for pickup at a shipping depot.
          - confirmed: The carrier is aware of the shipment, but hasn't received it yet.
          - in_transit: The shipment is being transported between shipping facilities on the way to its destination.
          - out_for_delivery: The shipment is being delivered to its final destination.
          - delivered: The shipment was successfully delivered.
          - failure: Something went wrong when pulling tracking information for the shipment, such as the tracking number was invalid or the shipment was canceled.
      - name: status
        description: >
          The status of the fulfillment. Valid values include:
          - pending: Shopify has created the fulfillment and is waiting for the third-party fulfillment service to transition it to 'open' or 'success'.
          - open: The fulfillment has been acknowledged by the service and is in processing.
          - success: The fulfillment was successful.
          - cancelled: The fulfillment was cancelled.
          - error: There was an error with the fulfillment request.
          - failure: The fulfillment request failed.
        tests:
          - accepted_values:
              values: ['pending', 'open', 'success', 'cancelled', 'error', 'failure']
              config:
                severity: warn # we pivot these out in shopify__inventory_levels
      - name: tracking_company
        description: The name of the tracking company. 
      - name: tracking_number
        description: Primary tracking number for the order.
      - name: tracking_numbers
        description: A list of tracking numbers, provided by the shipping company.
      - name: tracking_urls
        description: The URLs of tracking pages for the fulfillment.
      - name: updated_at
        description: The date and time (ISO 8601 format) when the fulfillment was last modified.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__inventory_item
    description: >
      An inventory item represents a physical good. It holds essential information about the physical good, including its SKU and whether its inventory is tracked.
      There is a 1:1 relationship between a product variant and an inventory item.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - inventory_item_id
            - source_relation
    columns:
      - name: is_deleted
        description: "{{ doc('_fivetran_deleted') }}"
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: cost
        description: The unit cost of the inventory item. The shop's default currency is used.
      - name: country_code_of_origin
        description: The country code (ISO 3166-1 alpha-2) of where the item came from.
      - name: created_at
        description: The date and time (ISO 8601 format) when the inventory item was created.
      - name: inventory_item_id
        description: The ID of the inventory item.
        tests:
          - not_null
      - name: province_code_of_origin
        description: The province code (ISO 3166-2 alpha-2) of where the item came from. The province code is only used if the shipping provider for the inventory item is Canada Post.
      - name: is_shipping_required
        description: Boolean representing whether a customer needs to provide a shipping address when placing an order containing the inventory item.
      - name: sku
        description: The unique SKU (stock keeping unit) of the inventory item.
      - name: is_inventory_quantity_tracked
        description: Boolean representing whether inventory levels are tracked for the item. If true, then the inventory quantity changes are tracked by Shopify.
      - name: updated_at
        description: The date and time (ISO 8601 format) when the inventory item was last modified.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__inventory_level
    description: >
      An inventory level represents the quantities of an inventory item for a location.

      Each inventory level belongs to one inventory item and has one location. For every location where an inventory item can be stocked, there's an inventory level that represents 
      the inventory item's quantities relating to that location.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - inventory_item_id
            - location_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: available_quantity
        description: The available quantity of an inventory item at the inventory level's associated location. Returns null if the inventory item is not tracked.
      - name: inventory_item_id
        description: The ID of the inventory item associated with the inventory level.
        tests:
          - not_null
      - name: location_id
        description: The ID of the location that the inventory level belongs to.
        tests:
          - not_null
      - name: updated_at
        description: The date and time (ISO 8601 format) when the inventory level was last modified.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__location
    description: A location represents a geographical location where your stores, pop-up stores, headquarters, and warehouses exist.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - location_id
            - source_relation
    columns:
      - name: is_deleted
        description: "{{ doc('_fivetran_deleted') }}"
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: is_active
        description: >
          Boolean representing whether the location is active. If true, then the location can be used to sell products, stock inventory, and fulfill orders.
      - name: address_1
        description: The location's street address.
      - name: address_2
        description: The optional second line of the location's street address.
      - name: city
        description: The city the location is in.
      - name: country
        description: The country the location is in (two-letter code).
      - name: country_code
        description: The two-letter code (ISO 3166-1 alpha-2 format) corresponding to country the location is in.
      - name: country_name
        description: Full name of the location's country.
      - name: created_at
        description: The date and time (ISO 8601 format) when the location was created.
      - name: location_id
        description: The ID of the location.
        tests:
          - not_null
      - name: is_legacy
        description: >
          Boolean representing whether this is a fulfillment service location. If true, then the location is a fulfillment service location. 
          If false, then the location was created by the merchant and isn't tied to a fulfillment service.
      - name: localized_country_name
        description: The localized name of the location's country.
      - name: localized_province_name
        description: The localized name of the location's region. Typically a province, state, or district.
      - name: name
        description: The name of the location.
      - name: phone
        description: The phone number of the location. This value can contain special characters, such as - or +.
      - name: province
        description: The province, state, or district of the location.
      - name: province_code
        description: The province, state, or district code (ISO 3166-2 alpha-2 format) of the location.
      - name: updated_at
        description: The date and time (ISO 8601 format) when the location was last updated.
      - name: zip
        description: The zip or postal code.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__metafield
    description: >
      Metafields are a flexible way to attach additional information to a Shopify resource (e.g. Product, Collection, etc.). Some examples of data stored using metafields include specifications, size charts, 
      downloadable documents, release dates, images, or part numbers. Metafields are identified by an owner resource, a namespace, and a key and they store a value along with type information for that context.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - metafield_id
            - source_relation    
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: created_at
        description: The date and time (ISO 8601 format) when the metafield was created.
      - name: description
        description: A description of the information that the metafield contains.
      - name: metafield_id
        description: The unique ID of the metafield.
        tests:
          - not_null
      - name: key
        description: The key of the metafield. Keys can be up to 64 characters long and can contain alphanumeric characters, hyphens, underscores, and periods.
      - name: namespace
        description: A container for a group of metafields. Grouping metafields within a namespace prevents your metafields from conflicting with other metafields with the same key name. Must have between 3-255 characters.
      - name: owner_resource_id
        description: The unique ID of the resource that the metafield is attached to.
      - name: owner_resource
        description: The type of resource (table) that the metafield is attached to.
      - name: value_type
        description: The type of data that the metafield stores in the `value` field. Refer to the [list](https://shopify.dev/apps/metafields/types) of supported types. Coalescing of type and value_type
      - name: updated_at
        description: The date and time (ISO 8601 format) when the metafield was last updated.
      - name: value
        description: The data to store in the metafield. The value is always stored as a string, regardless of the metafield's type.
      - name: metafield_reference
        description: Combination of the namespace and key columns. This field is key for metafield mapping in downstream models.
      - name: is_most_recent_record
        description: Boolean indicating the most up to date record identified by the most recent updated_at field.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__order_note_attribute
    description: Table storing custom attributes placed on orders. 
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_id
            - name
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: name
        description: Name of the attribute.
        tests:
          - not_null
      - name: order_id
        description: ID referencing the order the note attribute belongs to.
        tests:
          - not_null
      - name: value
        description: Value of the attribute.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__order_shipping_line
    description: Represents the shipping details that the customer chose for their order.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_shipping_line_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: carrier_identifier
        description: A reference to the carrier service that provided the rate. Present when the rate was computed by a third-party carrier service.
      - name: code
        description: A reference to the shipping method.
      - name: delivery_category
        description: The general classification of the delivery method.
      - name: discounted_price
        description: The pre-tax shipping price with discounts applied in shop currency.
      - name: discounted_price_set
        description: The pre-tax shipping price with discounts applied (JSON) in presentment and shop currencies.
      - name: order_shipping_line_id
        description: A globally-unique identifier.
        tests:
          - not_null
      - name: order_id
        description: ID of the associated order.
      - name: phone
        description: The phone number at the shipping address.
      - name: price
        description: Returns the price of the shipping line in shop currency.
      - name: price_set
        description: Returns the price of the shipping line (JSON) in shop and presentment currencies.
      - name: is_third_party_required
        description: The fulfillment service requested for the shipping method. Present if the shipping method requires processing by a third party fulfillment service.
      - name: source
        description: Returns the rate source for the shipping line.
      - name: title
        description: Returns the title of the shipping line.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__order_shipping_tax_line
    description: Represents taxes associated with order shipping lines.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_shipping_line_id
            - index
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: index
        description: Index (from 1) representing the order of shipping lines per order.
        tests:
          - not_null
      - name: order_shipping_line_id
        description: ID of the order shipping line this record is associated with.
        tests:
          - not_null
      - name: price
        description: The amount of tax, in shop currency, after discounts and before returns.
      - name: price_set
        description: The amount of tax, in shop and presentment currencies, after discounts and before returns (JSON).
      - name: rate
        description: The proportion of the line item price that the tax represents as a decimal.
      - name: title
        description: The name of the tax.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__order_tag
    description: Tags that the shop owner has attached to the order.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_id
            - index
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: index
        description: Index (starting from 1) representing when the tag was placed on the order. 
        tests:
          - not_null
      - name: order_id
        description: ID of the order being tagged.
        tests:
          - not_null
      - name: value
        description: Value of the tag.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__order_url_tag
    description: Key-value tags that the shop owner has attached to the order url.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_id
            - key
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: key
        description: Key of the tag pair.
        tests:
          - not_null
      - name: order_id
        description: ID of the order url being tagged.
        tests:
          - not_null
      - name: value
        description: Value of the tag.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__price_rule
    description: >
      Table storing price rules. You can use price rules to create discounts dependent on conditions. Merchants can distribute the discount codes to their customers. 
      Using price rules, you can create discounts that specify a discount as a percentage, a fixed amount, or free shipping. You use entitlements and prerequisites to dynamically build these discounts.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - price_rule_id
            - source_relation   
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: allocation_limit
        description: >
          The number of times the discount can be allocated on the cart - if eligible. For example a Buy 1 hat Get 1 hat for free discount can be applied 3 times on a cart having more than 6 hats, 
          where maximum of 3 hats get discounted - if the allocation_limit is 3. Empty (null) allocation_limit means unlimited number of allocations.
      - name: allocation_method
        description: >
          The allocation method of the price rule. Valid values include `each` (the discount is applied to each of the entitled items. For example, for a price rule that takes $15 off, each entitled line item in a checkout will be discounted by $15)
          and `across` (the calculated discount amount will be applied across the entitled items. For example, for a price rule that takes $15 off, the discount will be applied across all the entitled items).
      - name: created_at
        description: The date and time (ISO 8601 format) when the price rule was created.
      - name: customer_selection
        description: >
          The customer selection for the price rule. Valid values include `all` (the price rule is valid for all customers) and `prerequisite` 
          (the customer must either belong to one of the customer segments specified by customer_segment_prerequisite_ids, or be one of the customers specified by prerequisite_customer_ids).
      - name: ends_at
        description: The date and time (ISO 8601 format) when the price rule ends. Must be after starts_at.
      - name: price_rule_id
        description: The ID for the price rule.
        tests:
          - not_null
      - name: is_once_per_customer
        description: Boolean representing whether the generated discount code will be valid only for a single use per customer. This is tracked using customer ID.
      - name: prereq_min_quantity
        description: If `customer_selection` is `prerequisite`, the minimum number of items for the price rule to be applicable. The quantity of an entitled cart item must be greater than or equal to this value.
      - name: prereq_max_shipping_price
        description: If `customer_selection` is `prerequisite`, the maximum shipping price for the price rule to be applicable. The shipping price must be less than or equal to this value
      - name: prereq_min_subtotal
        description: If `customer_selection` is `prerequisite`, the minimum subtotal for the price rule to be applicable. The subtotal of the entitled cart items must be greater than or equal to this value for the discount to apply.
      - name: prereq_min_purchase_quantity_for_entitlement
        description: If `customer_selection` is `prerequisite`, the prerequisite purchase for a Buy X Get Y discount. The minimum purchase amount required to be entitled to the discount.
      - name: prereq_buy_x_get_this
        description: If `customer_selection` is `prerequisite`, in a Buy/Get ratio for a Buy X Get Y discount, this is the offered 'get' quantity.
      - name: prereq_buy_this_get_y
        description: If `customer_selection` is `prerequisite`, in a Buy/Get ratio for a Buy X Get Y discount, this defines the necessary 'buy' quantity.
      - name: starts_at
        description: The date and time (ISO 8601 format) when the price rule starts.
      - name: target_selection
        description: >
          The target selection method of the price rule. Valid values include `all` (the price rule applies the discount to all line items in the checkout) and 
          `entitled` (the price rule applies the discount to selected entitlements only).
      - name: target_type
        description: The target type that the price rule applies to. Valid values include `line_item` (the price rule applies to the cart's line items) and `shipping_line` (the price rule applies to the cart's shipping lines).
        tests:
          - accepted_values:
              values: ['line_item', 'shipping_line']
              config:
                severity: warn # we use these in a JOIN condition in shopify__discounts
      - name: title
        description: >
          The title of the price rule. This is used by the Shopify admin search to retrieve discounts. It is also displayed on the Discounts page of the Shopify admin for bulk discounts. 
          Shopify recommends that this map onto the associated `discount_code.code`.
      - name: updated_at
        description: The date and time (ISO 8601 format) when the price rule was updated.
      - name: usage_limit
        description: The maximum number of times the price rule can be used, per discount code.
      - name: value
        description: The value of the price rule. If if the value of `target_type` is `shipping_line`, then only -100 is accepted. The value must be negative.
      - name: value_type
        description: >
          The value type of the price rule. Valid values include `fixed_amount` (applies a discount of value as a unit of the store's currency. For example, if value is -30 and the store's currency is USD, then $30 USD is deducted when the discount is applied)
          and `percentage` (applies a percentage discount of value. For example, if value is -30, then 30% will be deducted when the discount is applied).

          If `target_type` is `shipping_line`, then only `percentage` is accepted.
        tests:
          - accepted_values:
              values: ['percentage', 'fixed_amount']
              config:
                severity: warn # we use these in a JOIN condition in shopify__discounts
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__product_image
    description: Table storing hosted images of products.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - product_image_id
            - product_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: created_at
        description: The date and time when the product image was created. The API returns this value in ISO 8601 format.
      - name: height
        description: Height dimension of the image which is determined on upload.
      - name: product_image_id
        description: Unique numeric identifier of the product image.
        tests:
          - not_null
      - name: position
        description: The order of the product image in the list. The first product image is at position 1 and is the "main" image for the product.
      - name: product_id
        description: The id of the product associated with the image.
      - name: src
        description: Specifies the location of the product image. This parameter supports URL filters that you can use to retrieve modified copies of the image.
      - name: updated_at
        description: The date and time when the product image was last modified. The API returns this value in ISO 8601 format.
      - name: variant_ids
        description: An array of variant ids associated with the image.
      - name: width
        description: Width dimension of the image which is determined on upload.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__product_tag
    description: Tags that the shop owner has attached to the product.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - product_id
            - index
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: index
        description: Index (starting from 1) representing when the tag was placed on the product. 
        tests:
          - not_null
      - name: product_id
        description: ID of the product being tagged.
        tests:
          - not_null
      - name: value
        description: Value of the tag.
      - name: source_relation
        description: "{{ doc('source_relation') }}"
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__shop
    description: The Shop resource is a collection of general business and store management settings and information about the store.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - shop_id
            - source_relation
    columns:
      - name: is_deleted
        description: "{{ doc('_fivetran_deleted') }}"
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: address_1
        description: The shop's street address.
      - name: address_2
        description: The optional second line of the shop's street address.
      - name: has_checkout_api_supported
        description: Boolean representing whether the shop is capable of accepting payments directly through the Checkout API.
      - name: city
        description: The shop's city.
      - name: cookie_consent_level
        description: The cookie consent level defined on the shop's online store.
      - name: country
        description: The shop's country. In most cases, this value matches the country_code.
      - name: country_code
        description: The two-letter country code corresponding to the shop's country.
      - name: country_name
        description: The shop's normalized country name.
      - name: has_county_taxes
        description: Boolean representing whether the shop is applying taxes on a per-county basis. Only applicable to shops based in the US. Either `true` or `null` (not false, according to Shopify API docs).
      - name: created_at
        description: The date and time (ISO 8601) when the shop was created.
      - name: currency
        description: The three-letter code (ISO 4217 format) for the shop's default currency.
      - name: customer_email
        description: The contact email used for communication between the shop owner and the customer.
      - name: domain
        description: The shop's domain.
      - name: is_eligible_for_card_reader_giveaway
        description: Boolean representing whether the shop is eligible to receive a free credit card reader from Shopify.
      - name: is_eligible_for_payments
        description: Boolean representing whether the shop is eligible to use Shopify Payments.
      - name: email
        description: The contact email used for communication between Shopify and the shop owner.
      - name: enabled_presentment_currencies
        description: An array of of enabled currencies (ISO 4217 format) that the shop accepts. Merchants can enable currencies from their Shopify Payments settings in the Shopify Admin.
      - name: google_apps_domain
        description: The GSuite URL for the store, if applicable.
      - name: is_google_apps_login_enabled
        description: Boolean representing whether the GSuite login is enabled. Shops with this feature will be able to log in through the GSuite login page. Valid values are `true` and `null`.
      - name: has_discounts
        description: Boolean representing whether any active discounts exist for the shop.
      - name: has_gift_cards
        description: Boolean representing whether any active gift cards exist for the shop.
      - name: has_storefront
        description: Boolean representing whether this shop has an online store.
      - name: iana_timezone
        description: The name of the timezone assigned by the [IANA](https://www.iana.org/time-zones).
      - name: shop_id
        description: The ID for the shop. A 64-bit unsigned integer.
        tests:
          - not_null
      - name: latitude
        description: The latitude of the shop's location.
      - name: longitude
        description: The longitude of the shop's location.
      - name: money_format
        description: A string representing the way currency is formatted when the currency isn't specified.
      - name: money_in_emails_format
        description: A string representing the way currency is formatted in email notifications when the currency isn't specified.
      - name: money_with_currency_format
        description: A string representing the way currency is formatted when the currency is specified.
      - name: money_with_currency_in_emails_format
        description: A string representing the way currency is formatted in email notifications when the currency is specified.
      - name: myshopify_domain
        description: The shop's .myshopify.com domain.
      - name: name
        description: The name of the shop.
      - name: is_password_enabled
        description: Boolean representing whether the password protection page is enabled on the shop's online store.
      - name: phone
        description: The contact phone number for the shop.
      - name: plan_display_name
        description: The display name of the Shopify plan the shop is on.
      - name: plan_name
        description: The name of the Shopify plan the shop is on.
      - name: is_pre_launch_enabled
        description: Boolean representing whether the pre-launch page is enabled on the shop's online store.
      - name: primary_locale
        description: The shop's primary locale, as configured in the language settings of the shop's theme.
      - name: province
        description: The shop's normalized province or state name.
      - name: province_code
        description: The two- or three-letter code for the shop's province or state.
      - name: is_extra_payments_agreement_required
        description: Boolean representing whether the shop requires an extra Shopify Payments agreement.
      - name: is_setup_required
        description: Boolean representing whether the shop has any outstanding setup steps.
      - name: shop_owner
        description: The username of the shop owner.
      - name: source
        description: The handle of the partner account that referred the merchant to Shopify, if applicable.
      - name: has_shipping_taxes
        description: Boolean representing whether taxes are charged for shipping. Valid values are true or false.
      - name: has_taxes_included_in_price
        description: Boolean representing whether applicable taxes are included in product prices. Valid values are true or null.
      - name: timezone
        description: The name of the timezone the shop is in.
      - name: updated_at
        description: The date and time (ISO 8601) when the shop was last updated.
      - name: weight_unit
        description: The default unit of weight measurement for the shop.
      - name: zip
        description: The shop's zip or postal code.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__tender_transaction
    description: >
      Each tender transaction represents money passing between the merchant and a customer. A tender transaction with a positive amount 
      represents a transaction where the customer paid money to the merchant. A negative amount represents a transaction where the 
      merchant refunded money back to the customer. Tender transactions represent transactions that modify the shop's balance.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_id
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: amount
        description: The amount of the tender transaction in the shop's currency.
      - name: currency
        description: The three-letter code (ISO 4217 format) for the currency used for the tender transaction.
      - name: transaction_id
        description: The ID of the transaction.
        tests:
          - not_null
      - name: order_id
        description: The ID of the order that the tender transaction belongs to.
      - name: payment_method
        description: >
          Information about the payment method used for this transaction. Valid values include:
          - credit_card
          - cash
          - android_pay
          - apple_pay
          - google_pay
          - samsung_pay
          - shopify_pay
          - amazon
          - klarna
          - paypal
          - unknown
          - other
      - name: processed_at
        description: The date and time (ISO 8601 format) when the tender transaction was processed.
      - name: remote_reference
        description: The remote (gateway) reference associated with the tender.
      - name: user_id
        description: The ID of the user logged into the Shopify POS device that processed the tender transaction, if applicable.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__abandoned_checkout_discount_code
    description: Abandoned checkouts that applied a discount code. 
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - checkout_id
            - code
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: amount
        description: The amount of the discount in presentment currency.
      - name: checkout_id
        description: ID of the checkout. 
        tests:
          - not_null
      - name: code
        description: The discount code.
      - name: created_at
        description: When the checkout discount application was created.
      - name: discount_id
        description: ID of the discount. Deprecated, use `code` instead.
      - name: type
        description: The type of discount. Valid values - percentage, shipping, fixed_amount. (default - fixed_amount)
      - name: updated_at
        description: When the checkout's discount was last updated
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__order_discount_code
    description: Discount codes placed on orders.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_id
            - index
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: amount
        description: The amount that's deducted from the order total.
      - name: code
        description: This property returns the discount code that was entered at checkout. Otherwise this property returns the title of the discount that was applied.
        tests:
          - not_null
      - name: order_id
        description: Associated order ID.
        tests:
          - not_null
      - name: type
        description: The type of discount - `fixed_amount`, `percentage`, or `shipping`.
      - name: source_relation
        description: "{{ doc('source_relation') }}"
      - name: index
        description: Pairs with `order_id` to provide unique identifier for order discount code.
      

  - name: stg_shopify__abandoned_checkout_shipping_line
    description: Shipping lines associated with abandoned checkouts.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - checkout_id
            - index
            - source_relation
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: carrier_identifier
        description: A reference to the carrier service that provided the rate. Present when the rate was computed by a third-party carrier service.
      - name: checkout_id
        description: ID of the checkout that was abandoned.
      - name: shipping_code
        description: A reference to the shipping method.
      - name: delivery_category
        description: The general classification of the delivery method.
      - name: delivery_expectation_range
        description: Expected delivery date range.
      - name: delivery_expectation_range_max
        description: Latest expected delivery date.
      - name: delivery_expectation_range_min
        description: Earliest possible expected delivery date.
      - name: delivery_expectation_type
        description: Type of expected delivery.
      - name: discounted_price
        description: The pre-tax shipping price with discounts applied in _presentment_ (customer) currency.
      - name: abandoned_checkout_shipping_line_id
        description: Unique ID of the abandoned checkout shipping line.
      - name: index
        description: Index of the line amongst shipping lines for this checkout.
      - name: phone
        description: The phone number at the shipping address.
      - name: price
        description: The price of the shipping method in presentment currency.
      - name: requested_fulfillment_service_id
        description: The fulfillment service requested for the shipping method. Present if the shipping method requires processing by a third party fulfillment service.
      - name: source
        description: The channel where the checkout originated. Example value - shopify.
      - name: title
        description: The title of the shipping method. Example value - International Shipping.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__fulfillment_event
    description: >
      The FulfillmentEvent resource represents tracking events that belong to a fulfillment of one or more items in an order. 
      Fulfillment events are displayed on the order status page to update customers on the status of their shipment.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - fulfillment_event_id
            - source_relation    
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: address_1
        description: The street address where the fulfillment event occurred.
      - name: city
        description: The city where the fulfillment event occurred.
      - name: country
        description: The country where the fulfillment event occurred.
      - name: created_at
        description: The date and time (ISO 8601 format) when the fulfillment event was created.
      - name: estimated_delivery_at
        description: >
          The estimated delivery date based on the fulfillment's tracking number, as long as it's provided by one of the following carriers: USPS, FedEx, UPS, or Canada Post (Canada only). 
          Value is `null` if no tracking number is available or if the tracking number is from an unsupported carrier. This property is available only when carrier calculated rates are in use.
      - name: fulfillment_id
        description: An ID for the fulfillment that's associated with the fulfillment event.
      - name: happened_at
        description: The date and time (ISO 8601 format) when the fulfillment event occurred.
      - name: fulfillment_event_id
        description: An ID for the fulfillment event.
      - name: latitude
        description: A geographic coordinate specifying the latitude of the fulfillment event.
      - name: longitude
        description: A geographic coordinate specifying the longitude of the fulfillment event.
      - name: message
        description: An arbitrary message describing the status. Can be provided by a shipping carrier.
      - name: order_id
        description: The ID of the order that's associated with the fulfillment event.
      - name: province
        description: The province where the fulfillment event occurred.
      - name: shop_id
        description: An ID for the shop that's associated with the fulfillment event.
      - name: status
        description: >
          The status of the fulfillment event. Valid values:
          - label_printed: A label for the shipment was purchased and printed.
          - label_purchased: A label for the shipment was purchased, but not printed.
          - attempted_delivery: Delivery of the shipment was attempted, but unable to be completed.
          - ready_for_pickup: The shipment is ready for pickup at a shipping depot.
          - picked_up: The fulfillment was successfully picked up.
          - confirmed: The carrier is aware of the shipment, but hasn't received it yet.
          - in_transit: The shipment is being transported between shipping facilities on the way to its destination.
          - out_for_delivery: The shipment is being delivered to its final destination.
          - delivered: The shipment was successfully delivered.
          - failure: Something went wrong when pulling tracking information for the shipment, such as the tracking number was invalid or the shipment was canceled.
        tests:
          - accepted_values:
              values:  ['attempted_delivery', 'delayed', 'delivered', 'failure', 'in_transit', 'out_for_delivery', 'ready_for_pickup', 'picked_up', 'label_printed', 'label_purchased', 'confirmed']
              config:
                severity: warn # we pivot these out in shopify__daily_shop
      - name: updated_at
        description: The date and time (ISO 8601 format) when the fulfillment event was updated.
      - name: zip
        description: The zip code of the location where the fulfillment event occurred.
      - name: source_relation
        description: "{{ doc('source_relation') }}"

  - name: stg_shopify__tax_line
    description: Represents a single tax applied to the associated line item.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_line_id
            - index
            - source_relation    
    columns:
      - name: _fivetran_synced
        description: "{{ doc('_fivetran_synced') }}"
      - name: index
        description: The index of the tax line.
      - name: order_line_id
        description: The order line that this tax line is associated with. 
      - name: price
        description: The amount of tax, in shop currency, after discounts and before returns. 
      - name: price_set
        description: The amount of tax, in shop and presentment currencies, after discounts and before returns.
      - name: rate
        description: The proportion of the line item price that the tax represents as a decimal.
      - name: title
        description: The name of the tax.
